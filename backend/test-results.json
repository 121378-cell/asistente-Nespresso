
> nespresso-assistant-backend@1.0.0 test
> vitest --run --reporter=json

{"numTotalTestSuites":30,"numPassedTestSuites":22,"numFailedTestSuites":8,"numPendingTestSuites":0,"numTotalTests":53,"numPassedTests":43,"numFailedTests":10,"numPendingTests":0,"numTodoTests":0,"snapshot":{"added":0,"failure":false,"filesAdded":0,"filesRemoved":0,"filesRemovedList":[],"filesUnmatched":0,"filesUpdated":0,"matched":0,"total":0,"unchecked":0,"uncheckedKeysByFile":[],"unmatched":0,"updated":0,"didUpdate":false},"startTime":1763804110012,"success":false,"testResults":[{"assertionResults":[{"ancestorTitles":["Health Check Endpoint"],"fullName":"Health Check Endpoint should return 200 and status ok","status":"passed","title":"should return 200 and status ok","duration":40.53679999999997,"failureMessages":[],"meta":{}},{"ancestorTitles":["Analytics Endpoint - Predefined Queries"],"fullName":"Analytics Endpoint - Predefined Queries should reject invalid query types","status":"passed","title":"should reject invalid query types","duration":28.093200000000024,"failureMessages":[],"meta":{}},{"ancestorTitles":["Analytics Endpoint - Predefined Queries"],"fullName":"Analytics Endpoint - Predefined Queries should accept valid query types","status":"passed","title":"should accept valid query types","duration":7.121700000000033,"failureMessages":[],"meta":{}}],"startTime":1763804110999,"endTime":1763804111075.1216,"status":"passed","message":"","name":"C:/Users/sergi/Desktop/proyectos/asistente Nespresso/backend/tests/api.test.ts"},{"assertionResults":[],"startTime":1763804110012,"endTime":1763804110012,"status":"failed","message":"exports is not defined in ES module scope\nThis file is being treated as an ES module because it has a '.js' file extension and 'C:\\Users\\sergi\\Desktop\\proyectos\\asistente Nespresso\\backend\\package.json' contains \"type\": \"module\". To treat it as a CommonJS script, rename it to use the '.cjs' file extension.","name":"C:/Users/sergi/Desktop/proyectos/asistente Nespresso/backend/tests/chatController.test.ts"},{"assertionResults":[{"ancestorTitles":["Gemini Service (Backend)","API Key Validation"],"fullName":"Gemini Service (Backend) API Key Validation should require GEMINI_API_KEY environment variable","status":"passed","title":"should require GEMINI_API_KEY environment variable","duration":3.293700000000058,"failureMessages":[],"meta":{}},{"ancestorTitles":["Gemini Service (Backend)","API Key Validation"],"fullName":"Gemini Service (Backend) API Key Validation should not expose API key in error messages","status":"passed","title":"should not expose API key in error messages","duration":1.1527000000000953,"failureMessages":[],"meta":{}},{"ancestorTitles":["Gemini Service (Backend)","Security"],"fullName":"Gemini Service (Backend) Security should not expose API key in responses","status":"passed","title":"should not expose API key in responses","duration":0.6338000000000648,"failureMessages":[],"meta":{}},{"ancestorTitles":["Gemini Service (Backend)","Security"],"fullName":"Gemini Service (Backend) Security should sanitize sensitive data from logs","status":"passed","title":"should sanitize sensitive data from logs","duration":1.2133000000000038,"failureMessages":[],"meta":{}},{"ancestorTitles":["Gemini Service (Backend)","Response Generation"],"fullName":"Gemini Service (Backend) Response Generation should handle successful response generation","status":"passed","title":"should handle successful response generation","duration":3.133199999999988,"failureMessages":[],"meta":{}},{"ancestorTitles":["Gemini Service (Backend)","Response Generation"],"fullName":"Gemini Service (Backend) Response Generation should handle empty history","status":"passed","title":"should handle empty history","duration":0.47939999999994143,"failureMessages":[],"meta":{}},{"ancestorTitles":["Gemini Service (Backend)","Response Generation"],"fullName":"Gemini Service (Backend) Response Generation should validate message format","status":"passed","title":"should validate message format","duration":1.3547999999999547,"failureMessages":[],"meta":{}},{"ancestorTitles":["Gemini Service (Backend)","Response Generation"],"fullName":"Gemini Service (Backend) Response Generation should handle machine model context","status":"passed","title":"should handle machine model context","duration":0.47500000000002274,"failureMessages":[],"meta":{}},{"ancestorTitles":["Gemini Service (Backend)","Machine Identification"],"fullName":"Gemini Service (Backend) Machine Identification should validate base64 image input","status":"passed","title":"should validate base64 image input","duration":0.9113999999999578,"failureMessages":[],"meta":{}},{"ancestorTitles":["Gemini Service (Backend)","Machine Identification"],"fullName":"Gemini Service (Backend) Machine Identification should return expected machine identification format","status":"passed","title":"should return expected machine identification format","duration":0.6874000000000251,"failureMessages":[],"meta":{}},{"ancestorTitles":["Video Generation Service","Aspect Ratio Validation"],"fullName":"Video Generation Service Aspect Ratio Validation should validate aspect ratio parameter","status":"passed","title":"should validate aspect ratio parameter","duration":0.5149000000000115,"failureMessages":[],"meta":{}},{"ancestorTitles":["Video Generation Service","Aspect Ratio Validation"],"fullName":"Video Generation Service Aspect Ratio Validation should reject invalid aspect ratios","status":"passed","title":"should reject invalid aspect ratios","duration":0.9126999999999725,"failureMessages":[],"meta":{}},{"ancestorTitles":["Video Generation Service","Video Generation"],"fullName":"Video Generation Service Video Generation should validate video generation request format","status":"passed","title":"should validate video generation request format","duration":0.6464999999999463,"failureMessages":[],"meta":{}},{"ancestorTitles":["Video Generation Service","Video Generation"],"fullName":"Video Generation Service Video Generation should handle video operation response","status":"passed","title":"should handle video operation response","duration":0.4552999999999656,"failureMessages":[],"meta":{}},{"ancestorTitles":["Video Generation Service","Video Status Checking"],"fullName":"Video Generation Service Video Status Checking should handle processing status","status":"passed","title":"should handle processing status","duration":0.4174000000000433,"failureMessages":[],"meta":{}},{"ancestorTitles":["Video Generation Service","Video Status Checking"],"fullName":"Video Generation Service Video Status Checking should handle completed status","status":"passed","title":"should handle completed status","duration":0.7002999999999702,"failureMessages":[],"meta":{}},{"ancestorTitles":["Video Generation Service","Video Status Checking"],"fullName":"Video Generation Service Video Status Checking should handle failed status","status":"passed","title":"should handle failed status","duration":0.3727999999999838,"failureMessages":[],"meta":{}}],"startTime":1763804110670,"endTime":1763804110690.3728,"status":"passed","message":"","name":"C:/Users/sergi/Desktop/proyectos/asistente Nespresso/backend/tests/gemini.test.ts"},{"assertionResults":[{"ancestorTitles":["Repairs Controller","GET /api/repairs"],"fullName":"Repairs Controller GET /api/repairs should return all repairs with first message preview","status":"failed","title":"should return all repairs with first message preview","duration":479.4079999999999,"failureMessages":["AssertionError: expected [ { ÔÇª(8) }, { ÔÇª(8) }, { ÔÇª(8) }, ÔÇª(13) ] to have a length of 2 but got 16\n    at Proxy.<anonymous> (file:///C:/Users/sergi/Desktop/proyectos/asistente%20Nespresso/backend/node_modules/@vitest/expect/dist/index.js:1322:20)\n    at Proxy.<anonymous> (file:///C:/Users/sergi/Desktop/proyectos/asistente%20Nespresso/backend/node_modules/@vitest/expect/dist/index.js:1090:14)\n    at Proxy.methodWrapper (file:///C:/Users/sergi/Desktop/proyectos/asistente%20Nespresso/backend/node_modules/chai/index.js:1700:25)\n    at C:/Users/sergi/Desktop/proyectos/asistente Nespresso/backend/tests/repairsController.test.ts:62:35\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at file:///C:/Users/sergi/Desktop/proyectos/asistente%20Nespresso/backend/node_modules/@vitest/runner/dist/index.js:912:20"],"meta":{}},{"ancestorTitles":["Repairs Controller","GET /api/repairs"],"fullName":"Repairs Controller GET /api/repairs should handle database errors","status":"failed","title":"should handle database errors","duration":80.16750000000002,"failureMessages":["AssertionError: expected 200 to be 500 // Object.is equality\n    at C:/Users/sergi/Desktop/proyectos/asistente Nespresso/backend/tests/repairsController.test.ts:80:37\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at file:///C:/Users/sergi/Desktop/proyectos/asistente%20Nespresso/backend/node_modules/@vitest/runner/dist/index.js:912:20"],"meta":{}},{"ancestorTitles":["Repairs Controller","GET /api/repairs/:id"],"fullName":"Repairs Controller GET /api/repairs/:id should return specific repair with all messages","status":"failed","title":"should return specific repair with all messages","duration":99.21489999999994,"failureMessages":["AssertionError: expected 404 to be 200 // Object.is equality\n    at C:/Users/sergi/Desktop/proyectos/asistente Nespresso/backend/tests/repairsController.test.ts:115:37\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at file:///C:/Users/sergi/Desktop/proyectos/asistente%20Nespresso/backend/node_modules/@vitest/runner/dist/index.js:912:20"],"meta":{}},{"ancestorTitles":["Repairs Controller","GET /api/repairs/:id"],"fullName":"Repairs Controller GET /api/repairs/:id should return 404 if repair not found","status":"passed","title":"should return 404 if repair not found","duration":62.20640000000003,"failureMessages":[],"meta":{}},{"ancestorTitles":["Repairs Controller","GET /api/repairs/:id"],"fullName":"Repairs Controller GET /api/repairs/:id should handle database errors","status":"failed","title":"should handle database errors","duration":35.012300000000096,"failureMessages":["AssertionError: expected 404 to be 500 // Object.is equality\n    at C:/Users/sergi/Desktop/proyectos/asistente Nespresso/backend/tests/repairsController.test.ts:137:37\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at file:///C:/Users/sergi/Desktop/proyectos/asistente%20Nespresso/backend/node_modules/@vitest/runner/dist/index.js:912:20"],"meta":{}},{"ancestorTitles":["Repairs Controller","POST /api/repairs"],"fullName":"Repairs Controller POST /api/repairs should return 400 if name is missing","status":"passed","title":"should return 400 if name is missing","duration":22.183899999999994,"failureMessages":[],"meta":{}},{"ancestorTitles":["Repairs Controller","POST /api/repairs"],"fullName":"Repairs Controller POST /api/repairs should return 400 if messages are missing","status":"passed","title":"should return 400 if messages are missing","duration":6.585000000000036,"failureMessages":[],"meta":{}},{"ancestorTitles":["Repairs Controller","POST /api/repairs"],"fullName":"Repairs Controller POST /api/repairs should return 400 if messages array is empty","status":"passed","title":"should return 400 if messages array is empty","duration":5.581400000000031,"failureMessages":[],"meta":{}},{"ancestorTitles":["Repairs Controller","POST /api/repairs"],"fullName":"Repairs Controller POST /api/repairs should successfully create a repair","status":"failed","title":"should successfully create a repair","duration":383.1251,"failureMessages":["AssertionError: expected { ÔÇª(6) } to have property \"id\" with value 'new-id'\n    at C:/Users/sergi/Desktop/proyectos/asistente Nespresso/backend/tests/repairsController.test.ts:201:35\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at file:///C:/Users/sergi/Desktop/proyectos/asistente%20Nespresso/backend/node_modules/@vitest/runner/dist/index.js:912:20"],"meta":{}},{"ancestorTitles":["Repairs Controller","POST /api/repairs"],"fullName":"Repairs Controller POST /api/repairs should create repair with attachments","status":"passed","title":"should create repair with attachments","duration":364.2854000000002,"failureMessages":[],"meta":{}},{"ancestorTitles":["Repairs Controller","POST /api/repairs"],"fullName":"Repairs Controller POST /api/repairs should handle creation errors","status":"failed","title":"should handle creation errors","duration":249.54320000000007,"failureMessages":["AssertionError: expected 201 to be 500 // Object.is equality\n    at C:/Users/sergi/Desktop/proyectos/asistente Nespresso/backend/tests/repairsController.test.ts:252:37\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at file:///C:/Users/sergi/Desktop/proyectos/asistente%20Nespresso/backend/node_modules/@vitest/runner/dist/index.js:912:20"],"meta":{}},{"ancestorTitles":["Repairs Controller","PUT /api/repairs/:id"],"fullName":"Repairs Controller PUT /api/repairs/:id should successfully update repair name","status":"failed","title":"should successfully update repair name","duration":149.1968999999999,"failureMessages":["AssertionError: expected 404 to be 200 // Object.is equality\n    at C:/Users/sergi/Desktop/proyectos/asistente Nespresso/backend/tests/repairsController.test.ts:274:37\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at file:///C:/Users/sergi/Desktop/proyectos/asistente%20Nespresso/backend/node_modules/@vitest/runner/dist/index.js:912:20"],"meta":{}},{"ancestorTitles":["Repairs Controller","PUT /api/repairs/:id"],"fullName":"Repairs Controller PUT /api/repairs/:id should return 404 if repair not found","status":"passed","title":"should return 404 if repair not found","duration":151.50710000000026,"failureMessages":[],"meta":{}},{"ancestorTitles":["Repairs Controller","PUT /api/repairs/:id"],"fullName":"Repairs Controller PUT /api/repairs/:id should handle update errors","status":"failed","title":"should handle update errors","duration":87.04420000000027,"failureMessages":["AssertionError: expected 404 to be 500 // Object.is equality\n    at C:/Users/sergi/Desktop/proyectos/asistente Nespresso/backend/tests/repairsController.test.ts:298:37\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at file:///C:/Users/sergi/Desktop/proyectos/asistente%20Nespresso/backend/node_modules/@vitest/runner/dist/index.js:912:20"],"meta":{}},{"ancestorTitles":["Repairs Controller","DELETE /api/repairs/:id"],"fullName":"Repairs Controller DELETE /api/repairs/:id should successfully delete repair","status":"failed","title":"should successfully delete repair","duration":66.77449999999999,"failureMessages":["AssertionError: expected 404 to be 200 // Object.is equality\n    at C:/Users/sergi/Desktop/proyectos/asistente Nespresso/backend/tests/repairsController.test.ts:309:37\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at file:///C:/Users/sergi/Desktop/proyectos/asistente%20Nespresso/backend/node_modules/@vitest/runner/dist/index.js:912:20"],"meta":{}},{"ancestorTitles":["Repairs Controller","DELETE /api/repairs/:id"],"fullName":"Repairs Controller DELETE /api/repairs/:id should return 404 if repair not found","status":"passed","title":"should return 404 if repair not found","duration":41.1592999999998,"failureMessages":[],"meta":{}},{"ancestorTitles":["Repairs Controller","DELETE /api/repairs/:id"],"fullName":"Repairs Controller DELETE /api/repairs/:id should handle deletion errors","status":"failed","title":"should handle deletion errors","duration":111.4344000000001,"failureMessages":["AssertionError: expected 404 to be 500 // Object.is equality\n    at C:/Users/sergi/Desktop/proyectos/asistente Nespresso/backend/tests/repairsController.test.ts:329:37\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at file:///C:/Users/sergi/Desktop/proyectos/asistente%20Nespresso/backend/node_modules/@vitest/runner/dist/index.js:912:20"],"meta":{}}],"startTime":1763804111094,"endTime":1763804113491.4343,"status":"failed","message":"","name":"C:/Users/sergi/Desktop/proyectos/asistente Nespresso/backend/tests/repairsController.test.ts"},{"assertionResults":[{"ancestorTitles":["Security Tests","SQL Injection Prevention"],"fullName":"Security Tests SQL Injection Prevention should only accept predefined query types","status":"passed","title":"should only accept predefined query types","duration":3.2871000000000095,"failureMessages":[],"meta":{}},{"ancestorTitles":["Security Tests","SQL Injection Prevention"],"fullName":"Security Tests SQL Injection Prevention should validate queryType parameter","status":"passed","title":"should validate queryType parameter","duration":0.3687999999999647,"failureMessages":[],"meta":{}},{"ancestorTitles":["Security Tests","Environment Variables"],"fullName":"Security Tests Environment Variables should not expose sensitive environment variables","status":"passed","title":"should not expose sensitive environment variables","duration":0.31179999999994834,"failureMessages":[],"meta":{}},{"ancestorTitles":["Security Tests","API Response Sanitization"],"fullName":"Security Tests API Response Sanitization should not include internal error details in production","status":"passed","title":"should not include internal error details in production","duration":0.7956000000000358,"failureMessages":[],"meta":{}}],"startTime":1763804110661,"endTime":1763804110666.7957,"status":"passed","message":"","name":"C:/Users/sergi/Desktop/proyectos/asistente Nespresso/backend/tests/security.test.ts"},{"assertionResults":[{"ancestorTitles":["Video Controller","POST /api/video/generate"],"fullName":"Video Controller POST /api/video/generate should return 400 if prompt is missing","status":"passed","title":"should return 400 if prompt is missing","duration":49.40090000000009,"failureMessages":[],"meta":{}},{"ancestorTitles":["Video Controller","POST /api/video/generate"],"fullName":"Video Controller POST /api/video/generate should return 400 if prompt is not a string","status":"passed","title":"should return 400 if prompt is not a string","duration":7.700199999999995,"failureMessages":[],"meta":{}},{"ancestorTitles":["Video Controller","POST /api/video/generate"],"fullName":"Video Controller POST /api/video/generate should return 400 if image data is missing","status":"passed","title":"should return 400 if image data is missing","duration":6.046600000000126,"failureMessages":[],"meta":{}},{"ancestorTitles":["Video Controller","POST /api/video/generate"],"fullName":"Video Controller POST /api/video/generate should return 400 if image is incomplete","status":"passed","title":"should return 400 if image is incomplete","duration":5.971700000000055,"failureMessages":[],"meta":{}},{"ancestorTitles":["Video Controller","POST /api/video/generate"],"fullName":"Video Controller POST /api/video/generate should return 400 if aspectRatio is invalid","status":"passed","title":"should return 400 if aspectRatio is invalid","duration":6.369200000000092,"failureMessages":[],"meta":{}},{"ancestorTitles":["Video Controller","POST /api/video/generate"],"fullName":"Video Controller POST /api/video/generate should successfully generate video with 16:9 aspect ratio","status":"passed","title":"should successfully generate video with 16:9 aspect ratio","duration":8.15890000000013,"failureMessages":[],"meta":{}},{"ancestorTitles":["Video Controller","POST /api/video/generate"],"fullName":"Video Controller POST /api/video/generate should successfully generate video with 9:16 aspect ratio","status":"passed","title":"should successfully generate video with 9:16 aspect ratio","duration":5.295100000000048,"failureMessages":[],"meta":{}},{"ancestorTitles":["Video Controller","POST /api/video/generate"],"fullName":"Video Controller POST /api/video/generate should handle generation errors","status":"passed","title":"should handle generation errors","duration":13.819600000000037,"failureMessages":[],"meta":{}},{"ancestorTitles":["Video Controller","POST /api/video/status"],"fullName":"Video Controller POST /api/video/status should return 400 if operation is missing","status":"passed","title":"should return 400 if operation is missing","duration":12.07340000000022,"failureMessages":[],"meta":{}},{"ancestorTitles":["Video Controller","POST /api/video/status"],"fullName":"Video Controller POST /api/video/status should successfully check video status - processing","status":"passed","title":"should successfully check video status - processing","duration":7.211299999999937,"failureMessages":[],"meta":{}},{"ancestorTitles":["Video Controller","POST /api/video/status"],"fullName":"Video Controller POST /api/video/status should successfully check video status - completed","status":"passed","title":"should successfully check video status - completed","duration":4.878999999999905,"failureMessages":[],"meta":{}},{"ancestorTitles":["Video Controller","POST /api/video/status"],"fullName":"Video Controller POST /api/video/status should handle status check errors","status":"passed","title":"should handle status check errors","duration":7.33199999999988,"failureMessages":[],"meta":{}}],"startTime":1763804111081,"endTime":1763804111216.332,"status":"passed","message":"","name":"C:/Users/sergi/Desktop/proyectos/asistente Nespresso/backend/tests/videoController.test.ts"}]}
